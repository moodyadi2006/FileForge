(()=>{var e={};e.id=176,e.ids=[176],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7361:(e,r,t)=>{"use strict";t.d(r,{N:()=>u});var s=t(13581),i=t(36344),o=t(78521),n=t(70616),a=t(85663);let u={providers:[(0,s.A)({id:"credentials",name:"Credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){await (0,o.A)();try{let r=await n.A.findOne({$or:[{email:e.identifier}]});if(!r||!r.isVerified)return null;return await a.Ay.compare(e.password,r.password)?r:null}catch(e){return null}}}),(0,i.A)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET})],pages:{signIn:"/signIn"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET,callbacks:{async signIn({user:e,account:r}){if(console.log(e),r?.provider==="google"){await (0,o.A)();let r=await n.A.findOne({email:e.email});if(!r||!r.isVerified)return console.log("Blocked Google sign-in: User not found or not verified"),!1}return!0},async jwt({token:e,user:r,account:t}){let s=Math.floor(Date.now()/1e3);if(r&&(e.fullName=r.fullName||r.name,e.email=r.email),r&&t?.provider==="credentials"&&(e._id=r._id?.toString(),e.provider="credentials",e.accessToken=r._id?.toString()),t?.provider==="google"){e.provider="google",e.accessToken=t.access_token,e.expiresAt=s+(t.expires_at||3600),await (0,o.A)();let i=await n.A.findOne({email:r.email});i&&(e._id=i._id?.toString(),e.fullName=i.fullName)}return"google"===e.provider&&e.expiresAt&&e.expiresAt<s?(console.log("Google token expired, forcing logout"),null):e},session:async({session:e,token:r})=>r?(e.user._id=r._id,e.user.fullName=r.fullName,e.user.email=r.email,e.accessToken=r.accessToken,e.provider=r.provider,e.expiresAt=r.expiresAt,e):null}}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},53274:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>g,serverHooks:()=>v,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{POST:()=>f});var i=t(96559),o=t(48088),n=t(37719),a=t(32190),u=t(19854),p=t(7361),c=t(94612),l=t(94946),d=t.n(l);async function f(e){try{let r=await (0,u.getServerSession)(p.N);if(console.log(r),!r||!r.accessToken)return a.NextResponse.json({error:"Unauthorized"},{status:401});let t=await e.formData(),s=new(d());for(let[e,r]of t.entries())if("string"==typeof r)s.append(e,r);else{let t=Buffer.from(await r.arrayBuffer());s.append(e,t,r.name)}s.append("user_id",r.user._id),s.append("provider",r.provider);let i=await c.A.post(`${process.env.FASTAPI_BACKEND_URL}/compression`,s,{headers:{...s.getHeaders(),Authorization:`Bearer ${r.accessToken}`,"X-User-Provider":r.provider}});return a.NextResponse.json(i.data)}catch(e){if(console.error("API Error:",e.response?.data||e.message),e.response?.status===401)return a.NextResponse.json({error:"Authentication failed"},{status:401});return a.NextResponse.json({error:"Something went wrong while processing your request",details:e.response?.data||e.message},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/compression/route",pathname:"/api/compression",filename:"route",bundlePath:"app/api/compression/route"},resolvedPagePath:"C:\\Users\\addiv\\OneDrive\\Desktop\\Mars\\FileForge\\frontend\\src\\app\\api\\compression\\route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:x,serverHooks:v}=g;function y(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:x})}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56037:e=>{"use strict";e.exports=require("mongoose")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70616:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var s=t(56037),i=t.n(s);let o=new s.Schema({fullName:{type:String,required:!0,trim:!0},email:{type:String,required:!0,trim:!0,match:[/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,"Please use a valid email"],unique:!0},password:{type:String,required:!0,trim:!0},verifyCode:{type:String},isVerified:{type:Boolean,default:!1},verifyCodeExpiry:{type:Date}}),n=i().models.User||i().model("User",o)},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},78521:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var s=t(56037),i=t.n(s);let o={},n=async function(){if(o.isConnected)return void console.log("Already connected to databases");try{o.isConnected=(await i().connect(process.env.MONGODB_URI||"")).connections[0].readyState,console.log("DB connected successfully")}catch(e){console.log("DB connection failed"),process.exit(1)}}},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[719,613,793,190,612],()=>t(53274));module.exports=s})();